# Contributor: Łukasz Jendrysik <scadu@yandex.com>
# Contributor: Sören Tempel <soeren+alpine@soeren-tempel.net>
# Contributor: Takuya Noguchi <takninnovationresearch@gmail.com>
# Maintainer: Fabian Affolter <fabian@affolter-engineering.ch>
pkgname=ansible
pkgver=2.5.15
pkgrel=0
pkgdesc="A configuration-management, deployment, task-execution, and multinode orchestration framework"
url="https://ansible.com"
arch="noarch"
license="GPL-3.0-or-later"
_py=py3
depends="python3 $_py-yaml $_py-paramiko $_py-jinja2 $_py-markupsafe $_py-crypto"
makedepends="python3-dev py3-setuptools"
options="!check" # not packaged in release tarballs
subpackages="$pkgname-doc"
source="$pkgname-$pkgver.tar.gz::https://releases.ansible.com/ansible/$pkgname-$pkgver.tar.gz"
builddir="$srcdir/$pkgname-$pkgver"

# secfixes:
#   2.5.15:
#     - CVE-2019-3828
#   2.5.14:
#     - CVE-2018-16876
#   2.5.11:
#     - CVE-2018-16837

prepare() {
	# Windows-only scripts
	rm -r examples/scripts
}

build() {
	cd "$builddir"
	python3 setup.py build
}

package() {
	cd "$builddir"
	python3 setup.py install --prefix=/usr --root="$pkgdir"

	mkdir -p "$pkgdir"/usr/share/man/man1
	install -Dm644 "$builddir"/docs/man/man1/*.1 \
		"$pkgdir"/usr/share/man/man1/

	mkdir -p "$pkgdir"/usr/share/doc/$pkgname/examples/
	install -m644 examples/* \
		"$pkgdir"/usr/share/doc/$pkgname/examples/
	install -m644 README.rst "$pkgdir"/usr/share/doc/$pkgname
}

sha512sums="d8b0de7b616c2efb6d38748a84f602c9d5bc3d67ca8a5d2019d227bebf8e0f1d5d5295453f562414be34feeeac059f9e0c569f5e3f208ae2b3c1c7b8ca0c0329  ansible-2.5.15.tar.gz"
